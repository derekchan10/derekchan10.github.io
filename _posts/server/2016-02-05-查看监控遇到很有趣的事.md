---
layout: post
title: 查看监控遇到很有趣的事
category: 服务器
tags: 服务器,监控
keywords: 服务器,监控
description: 
---

近期部门公布了供部门内部人员使用的监控平台，一个开源的项目“Grafana”，能实时查看各种服务的监控，如:Nginx，Docker，PHP等等等等，当然这些都是可以自定义的，想要什么就给你什么。

今天重点不是讲这个开源系统怎么嵌入，而是昨天遇到的一件很有趣的事情。正值年前没有太多业务要做，无聊看了下网站监控，发现每天的6点到8点，隔一刻钟或者十分钟就有一波请求高峰，整点更为明显，当时很是不解，按理说这个点应该不是访问高峰期才对，怎么会有波动这么明显的数值。

[<img class="alignnone size-full wp-image-430" src="http://blog.gitdc.com/wp-content/uploads/2016/02/屏幕快照-2016-02-04-下午6.23.11.png" alt="屏幕快照 2016-02-04 下午6.23.11" width="650" height="304" />][1]

[<img class="alignnone wp-image-436 size-full" src="http://blog.gitdc.com/wp-content/uploads/2016/02/tmp021e1f47.png" alt="" width="632" height="308" />][2]

 

通过查看访问日志，发现"/api/v2/sync"的地址请求最频繁，这个Api是App用来同步数据的，进一步跟Android小伙伴了解后，Android小伙伴并没有在这个时间段设置了定时同步的代码，但是有注册了事件：当App在后台运行时，手机锁屏后再亮屏或者按Home键就会自动请求这个Api进行数据同步（大意是这样）。

[<img class="alignnone wp-image-432" src="http://blog.gitdc.com/wp-content/uploads/2016/02/屏幕快照-2016-02-04-下午6.26.56-1024x152.png" alt="屏幕快照 2016-02-04 下午6.26.56" width="700" height="104" />][3]

到这里就有个疑问了，为什么这么多用户会在这些时间点同时操作手机，特别是整点，最后我们通过监控图表来判断，应该是闹钟惹的祸 :!: ，当闹钟响，屏幕会亮，闹钟的响声就会促使用户去操作手机，从而访问这个同步接口，前提是我们的App挂在后台运行，所以啊，网上所讲的很多App偷跑流量真的是有依据可查的。针对这个问题安卓小伙伴已经列入计划年后回来进行优化，细思恐极，还好现在量并不大，如果以后量大了，这种情况就会变成每天定时的流量攻击，且有可能会造成服务器宕机或者服务挂掉的情况（夸张了点），而这些都是我们内部造成的，想想都觉得逗。

**<span style="color: #00ccff;">最后得出几点经验：</span>**

1、图形的确是比文字、代码要来得更直接，更能把想要的结果体现出来

2、服务监控是很有必要的，为网站保驾护航的好工具。

**宏观层面**

1、发现有什么问题时，一定要深入研究它，或许能有什么新发现和普通情况下察觉不到的问题，这些都是促使我们进步的因素。


[1]: http://blog.gitdc.com/wp-content/uploads/2016/02/屏幕快照-2016-02-04-下午6.23.11.png
[2]: http://blog.gitdc.com/wp-content/uploads/2016/02/tmp021e1f47.png
[3]: http://blog.gitdc.com/wp-content/uploads/2016/02/屏幕快照-2016-02-04-下午6.26.56-e1454640814967.png
